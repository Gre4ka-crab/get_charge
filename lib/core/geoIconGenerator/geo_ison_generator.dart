import 'dart:typed_data';
import 'dart:ui';

import 'package:flutter_svg/flutter_svg.dart';

Map<int, String> _numbers = {
  1: 'M13.24,8.59H14v9.1h-.91V9.59l-2,.61-.23-.78Z',
  2: 'M10.58,18v-.82l3.27-3.3a3.85,3.85,0,0,0,1.41-2.41,1.75,1.75,0,0,0-.54-1.36,1.88,1.88,0,0,0-1.3-.48,2.13,2.13,0,0,0-2,1.28l-.76-.45a2.92,2.92,0,0,1,1.17-1.28,3.16,3.16,0,0,1,1.63-.44,2.8,2.8,0,0,1,1.92.74,2.53,2.53,0,0,1,.83,2,2.83,2.83,0,0,1-.45,1.52,8.36,8.36,0,0,1-1.24,1.54l-2.6,2.58h4.48V18Z',
  3: 'M13.9142 12.683C14.6422 12.7783 15.2402 13.06 15.7082 13.528C16.1849 13.9873 16.4232 14.5983 16.4232 15.361C16.4232 16.2277 16.1242 16.9123 15.5262 17.415C14.9369 17.909 14.2176 18.156 13.3682 18.156C12.6922 18.156 12.0899 18 11.5612 17.688C11.0326 17.376 10.6599 16.9297 10.4432 16.349L11.1972 15.907C11.3446 16.3577 11.6089 16.7 11.9902 16.934C12.3716 17.1593 12.8309 17.272 13.3682 17.272C13.9922 17.272 14.5036 17.1073 14.9022 16.778C15.3096 16.44 15.5132 15.9677 15.5132 15.361C15.5132 14.7543 15.3096 14.2863 14.9022 13.957C14.5036 13.619 13.9922 13.45 13.3682 13.45V13.437L13.3552 13.45H13.1082L12.7182 12.852L14.9802 9.758H10.7032V8.9H16.0332V9.758L13.9142 12.683Z',
  4: 'M17.27,15.27v.86H16.1V18h-.91V16.13H10.38v-.86l3.38-6.42h1l-3.38,6.42h3.81V12.49h.91v2.78Z',
  5: 'M13.5,12.51a3.27,3.27,0,0,1,2.17.75,2.54,2.54,0,0,1,.89,2.05,2.54,2.54,0,0,1-.89,2,3.32,3.32,0,0,1-2.17.74,3.36,3.36,0,0,1-1.83-.5,2.46,2.46,0,0,1-1.09-1.43l.76-.45a1.86,1.86,0,0,0,.78,1.12,2.46,2.46,0,0,0,1.38.38,2.34,2.34,0,0,0,1.54-.5,1.7,1.7,0,0,0,.61-1.41A1.7,1.7,0,0,0,15,13.9a2.28,2.28,0,0,0-1.54-.5H11l.33-4.55h4.87v.86H12.16L12,12.51Z',
  6: 'M13.5,12.1a3,3,0,0,1,2.2.84,2.9,2.9,0,0,1,.86,2.16,2.92,2.92,0,0,1-.86,2.17,3.05,3.05,0,0,1-2.2.83,3.07,3.07,0,0,1-2.2-.83,2.92,2.92,0,0,1-.85-2.17A3,3,0,0,1,11,13.28l3-4.43h1l-2.24,3.33A3,3,0,0,1,13.5,12.1ZM12,16.63a2.06,2.06,0,0,0,1.55.59,2.06,2.06,0,0,0,1.55-.59,2,2,0,0,0,.6-1.53,2,2,0,0,0-.6-1.53A2.1,2.1,0,0,0,13.5,13a2.1,2.1,0,0,0-1.55.59,2,2,0,0,0-.59,1.53A2,2,0,0,0,12,16.63Z',
  7: 'M10.32,8.85h5.59v.86L12.47,18h-.94L15,9.71H10.32Z',
  8: 'M15.15,13.25a2.74,2.74,0,0,1,1.1.91,2.22,2.22,0,0,1,.41,1.32,2.35,2.35,0,0,1-.87,1.93,3.38,3.38,0,0,1-2.17.69,3.38,3.38,0,0,1-2.17-.69,2.35,2.35,0,0,1-.87-1.93A2.16,2.16,0,0,1,11,14.16a2.71,2.71,0,0,1,1.09-.91,2.2,2.2,0,0,1-1.2-2,2.27,2.27,0,0,1,.81-1.87,3.19,3.19,0,0,1,3.86,0,2.27,2.27,0,0,1,.81,1.87A2.19,2.19,0,0,1,15.15,13.25Zm-3.08,3.52a2.48,2.48,0,0,0,1.55.45,2.48,2.48,0,0,0,1.55-.45,1.53,1.53,0,0,0,.58-1.29,1.53,1.53,0,0,0-.58-1.3,2.54,2.54,0,0,0-1.55-.44,2.54,2.54,0,0,0-1.55.44,1.53,1.53,0,0,0-.58,1.3A1.53,1.53,0,0,0,12.07,16.77ZM14.92,10a2.06,2.06,0,0,0-1.3-.4,2.08,2.08,0,0,0-1.31.4,1.45,1.45,0,0,0-.52,1.23,1.45,1.45,0,0,0,.54,1.21,2.15,2.15,0,0,0,2.58,0,1.45,1.45,0,0,0,.54-1.21A1.43,1.43,0,0,0,14.92,10Z',
  9: 'M16.56,11.69A3.07,3.07,0,0,1,16,13.51L13,18H12l2.24-3.33a3.47,3.47,0,0,1-.73.08,3,3,0,0,1-2.2-.84,2.9,2.9,0,0,1-.85-2.17,2.89,2.89,0,0,1,.85-2.16,3,3,0,0,1,2.2-.84,3,3,0,0,1,2.2.84A2.9,2.9,0,0,1,16.56,11.69ZM12,10.16a2,2,0,0,0-.59,1.53A2,2,0,0,0,12,13.23a2.1,2.1,0,0,0,1.55.58,2.1,2.1,0,0,0,1.55-.58,2,2,0,0,0,.6-1.54,2,2,0,0,0-.6-1.53,2.1,2.1,0,0,0-1.55-.58A2.1,2.1,0,0,0,12,10.16Z',
  0: 'M16.69,16.82a2.91,2.91,0,0,1-2.54,1.28,2.91,2.91,0,0,1-2.54-1.28,5.82,5.82,0,0,1-.9-3.42,5.88,5.88,0,0,1,.9-3.43,2.94,2.94,0,0,1,2.54-1.28A2.94,2.94,0,0,1,16.69,10a5.88,5.88,0,0,1,.91,3.43A5.82,5.82,0,0,1,16.69,16.82Zm-4.4-.6a2.1,2.1,0,0,0,1.86,1,2.12,2.12,0,0,0,1.87-1,5.11,5.11,0,0,0,.67-2.82A5.06,5.06,0,0,0,16,10.58a2.12,2.12,0,0,0-1.87-1,2.1,2.1,0,0,0-1.86,1,5,5,0,0,0-.67,2.82A5,5,0,0,0,12.29,16.22Z',
};

class GeoIconGenerator {
  static Future<Uint8List> getImageBytes(int count, {Size? iconSize}) async {
    Size size = iconSize ?? const Size(81, 96);

    DrawableRoot svgDrawableRoot = await svg.fromSvgString(
      _generateSvg(width: size.width.toInt(), height: size.height.toInt(), count: count),
      '',
    );
    Image image = await svgDrawableRoot.toPicture().toImage(size.width.toInt(), size.height.toInt());
    ByteData? byteData = await image.toByteData(format: ImageByteFormat.png);
    return Uint8List.fromList(byteData?.buffer.asInt8List().toList() ?? []);
  }

  static String _generateSvg({required int width, required int height, required int count}) {
    double scale = width / 27;
    return '<svg width="100%" viewBox="0 0 $width $height" fill="none" xmlns="http://www.w3.org/2000/svg">'
        '<path transform="scale($scale)" d="M8.52043 29.5846C9.73061 31.1197 11.5455 32 13.5 32C15.4545 32 17.2694 31.1197 18.4796 29.5845C24.1333 '
        '22.4126 27 17.007 27 13.5178C27 6.06405 20.9439 0 13.5 0C6.0561 0 0 6.06405 0 13.5178C0 17.007 2.86672 22.4127 8.52043 '
        '29.5846Z" fill="#747C94" />'
        '<path transform="scale($scale)" d="${_numbers[count]}" fill="white"/>'
        '<circle transform="scale($scale)" cx="13.5" cy="13.5" r="11" stroke="white"/>'
        '</svg>';
  }
}
